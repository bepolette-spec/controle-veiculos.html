<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Controle de Ve√≠culos</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #e4e8f0 100%);
            min-height: 100vh;
            padding: 20px;
            color: #333;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }
        
        header {
            background: #0078d4;
            color: white;
            padding: 20px;
            text-align: center;
        }
        
        .logo {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            margin-bottom: 10px;
        }
        
        .logo-icon {
            font-size: 32px;
        }
        
        h1 {
            font-size: 24px;
            font-weight: 600;
        }
        
        .tabs {
            display: flex;
            background: #f0f7ff;
            border-bottom: 1px solid #e0e0e0;
        }
        
        .tab {
            padding: 15px 20px;
            cursor: pointer;
            text-align: center;
            flex: 1;
            font-weight: 500;
            transition: all 0.3s;
        }
        
        .tab.active {
            background: #0078d4;
            color: white;
        }
        
        .tab-content {
            display: none;
            padding: 20px;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .vehicle-status {
            display: flex;
            gap: 20px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }
        
        .vehicle-card {
            flex: 1;
            min-width: 300px;
            background: #f9f9f9;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            text-align: center;
        }
        
        .vehicle-card h3 {
            margin-bottom: 15px;
            color: #0078d4;
        }
        
        .status {
            display: inline-block;
            padding: 5px 15px;
            border-radius: 20px;
            font-weight: 500;
            margin-bottom: 15px;
        }
        
        .status.available {
            background: #e6f7ee;
            color: #2ecc71;
        }
        
        .status.in-use {
            background: #ffe6e6;
            color: #e74c3c;
        }
        
        .alert-warning {
            background: #fff3cd;
            color: #856404;
            padding: 10px 15px;
            border-radius: 5px;
            margin: 10px 0;
            border-left: 4px solid #ffc107;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.7; }
            100% { opacity: 1; }
        }
        
        .vehicle-info {
            text-align: left;
            margin-top: 15px;
            border-top: 1px solid #eee;
            padding-top: 15px;
        }
        
        .vehicle-info p {
            margin-bottom: 8px;
            font-size: 14px;
        }
        
        .form-container {
            background: #f9f9f9;
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
        }
        
        .form-section {
            margin-bottom: 25px;
        }
        
        .form-section h3 {
            margin-bottom: 15px;
            color: #0078d4;
            padding-bottom: 5px;
            border-bottom: 1px solid #eee;
        }
        
        .form-row {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }
        
        .form-group {
            flex: 1;
            min-width: 200px;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
        }
        
        input, select, textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
        }
        
        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 500;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s;
        }
        
        .btn-primary {
            background: #0078d4;
            color: white;
        }
        
        .btn-primary:hover {
            background: #0066b8;
        }
        
        .btn-secondary {
            background: #95a5a6;
            color: white;
        }
        
        .btn-secondary:hover {
            background: #7f8c8d;
        }
        
        .btn-danger {
            background: #e74c3c;
            color: white;
        }
        
        .btn-danger:hover {
            background: #c0392b;
        }
        
        .fuel-level {
            display: flex;
            margin: 10px 0;
            flex-wrap: wrap;
            gap: 5px;
            justify-content: center;
        }
        
        .fuel-option {
            padding: 8px 12px;
            background: #f0f0f0;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s;
            border: 1px solid #ddd;
        }
        
        .fuel-option.selected {
            background: #0078d4;
            color: white;
            border-color: #0078d4;
        }
        
        .history-container {
            margin-top: 30px;
        }
        
        .history-item {
            background: #f9f9f9;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
            position: relative;
        }
        
        .history-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            font-weight: 500;
            color: #0078d4;
        }
        
        .history-details {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            font-size: 14px;
        }
        
        .admin-panel {
            background: #fff3e0;
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
        }
        
        .admin-panel h3 {
            color: #f57c00;
            margin-bottom: 15px;
        }
        
        .vehicle-list {
            margin-top: 20px;
        }
        
        .vehicle-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            border-bottom: 1px solid #eee;
        }
        
        .vehicle-item:last-child {
            border-bottom: none;
        }
        
        .vehicle-actions {
            display: flex;
            gap: 10px;
        }
        
        .password-prompt {
            background: #f9f9f9;
            padding: 20px;
            border-radius: 8px;
            margin-top: 20px;
            text-align: center;
        }
        
        .password-prompt input {
            max-width: 300px;
            margin: 10px auto;
        }
        
        .delete-history-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background: #e74c3c;
            color: white;
            border: none;
            border-radius: 3px;
            padding: 5px 10px;
            cursor: pointer;
            font-size: 12px;
        }
        
        .sync-status {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: #0078d4;
            color: white;
            padding: 10px 15px;
            border-radius: 5px;
            font-size: 14px;
            display: none;
        }
        
        @media (max-width: 768px) {
            .vehicle-status {
                flex-direction: column;
            }
            
            .form-row {
                flex-direction: column;
                gap: 10px;
            }
            
            .form-group {
                min-width: 100%;
            }
            
            .history-details {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="logo">
                <div class="logo-icon">üöó</div>
                <h1>Controle de Ve√≠culos</h1>
            </div>
        </header>
        
        <div class="tabs">
            <div class="tab active" onclick="showTab('status')">Status dos Ve√≠culos</div>
            <div class="tab" onclick="showTab('retirada')">Registrar Retirada</div>
            <div class="tab" onclick="showTab('devolucao')">Registrar Devolu√ß√£o</div>
            <div class="tab" onclick="showTab('historico')">Hist√≥rico</div>
            <div class="tab" onclick="showTab('admin')">Administra√ß√£o</div>
        </div>
        
        <div id="status" class="tab-content active">
            <h2>Status dos Ve√≠culos</h2>
            <p>Veja abaixo a situa√ß√£o atual dos ve√≠culos da empresa:</p>
            
            <div class="vehicle-status" id="vehicle-status-container">
                <!-- Os ve√≠culos ser√£o carregados aqui via JavaScript -->
            </div>
        </div>
        
        <div id="retirada" class="tab-content">
            <h2>Registrar Retirada de Ve√≠culo</h2>
            <p>Preencha os dados abaixo para registrar a retirada de um ve√≠culo:</p>
            
            <div class="form-container">
                <div class="form-section">
                    <h3>Dados do Ve√≠culo</h3>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="veiculo">Selecione o ve√≠culo:</label>
                            <select id="veiculo" onchange="atualizarKmRetirada()">
                                <option value="">Selecione...</option>
                                <!-- Op√ß√µes ser√£o preenchidas via JavaScript -->
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="km-retirada">Quilometragem na retirada:</label>
                            <input type="number" id="km-retirada" readonly>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>N√≠vel de combust√≠vel na retirada:</label>
                            <div class="fuel-level" id="fuel-level-retirada">
                                <div class="fuel-option" data-value="Reserva">Reserva</div>
                                <div class="fuel-option" data-value="1/4">1/4</div>
                                <div class="fuel-option" data-value="1/3">1/3</div>
                                <div class="fuel-option" data-value="1/2">1/2</div>
                                <div class="fuel-option" data-value="2/3">2/3</div>
                                <div class="fuel-option" data-value="3/4">3/4</div>
                                <div class="fuel-option" data-value="Cheio">Cheio</div>
                            </div>
                            <input type="hidden" id="combustivel-retirada">
                        </div>
                    </div>
                    <div id="alerta-reserva" class="alert-warning" style="display: none;">
                        ‚ö†Ô∏è Ve√≠culo na reserva, favor abastecer o carro!
                    </div>
                </div>
                
                <div class="form-section">
                    <h3>Dados do Respons√°vel</h3>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="nome">Nome completo:</label>
                            <input type="text" id="nome">
                        </div>
                        <div class="form-group">
                            <label for="celular">Celular:</label>
                            <input type="tel" id="celular">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="cnh-validade">Validade da CNH:</label>
                            <input type="date" id="cnh-validade">
                        </div>
                    </div>
                </div>
                
                <div class="form-section">
                    <h3>Dados da Utiliza√ß√£o</h3>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="data-retirada">Data e hora de retirada:</label>
                            <input type="datetime-local" id="data-retirada">
                        </div>
                        <div class="form-group">
                            <label for="destino">Destino/Objetivo do uso:</label>
                            <input type="text" id="destino">
                        </div>
                    </div>
                </div>
                
                <button class="btn btn-primary" onclick="registrarRetirada()">Registrar Retirada</button>
            </div>
        </div>
        
        <div id="devolucao" class="tab-content">
            <h2>Registrar Devolu√ß√£o de Ve√≠culo</h2>
            <p>Preencha os dados abaixo para registrar a devolu√ß√£o de um ve√≠culo:</p>
            
            <div class="form-container">
                <div class="form-row">
                    <div class="form-group">
                        <label for="veiculo-devolucao">Selecione o ve√≠culo:</label>
                        <select id="veiculo-devolucao" onchange="carregarKmDevolucao()">
                            <option value="">Selecione...</option>
                            <!-- Op√ß√µes ser√£o preenchidas via JavaScript -->
                        </select>
                    </div>
                </div>
                
                <div class="form-section">
                    <h3>Dados da Devolu√ß√£o</h3>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="data-devolucao">Data e hora de devolu√ß√£o:</label>
                            <input type="datetime-local" id="data-devolucao">
                        </div>
                        <div class="form-group">
                            <label for="km-devolucao">Quilometragem na devolu√ß√£o:</label>
                            <input type="number" id="km-devolucao">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>N√≠vel de combust√≠vel na devolu√ß√£o:</label>
                            <div class="fuel-level" id="fuel-level-devolucao">
                                <div class="fuel-option" data-value="Reserva">Reserva</div>
                                <div class="fuel-option" data-value="1/4">1/4</div>
                                <div class="fuel-option" data-value="1/3">1/3</div>
                                <div class="fuel-option" data-value="1/2">1/2</div>
                                <div class="fuel-option" data-value="2/3">2/3</div>
                                <div class="fuel-option" data-value="3/4">3/4</div>
                                <div class="fuel-option" data-value="Cheio">Cheio</div>
                            </div>
                            <input type="hidden" id="combustivel-devolucao">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="observacoes">Observa√ß√µes:</label>
                            <textarea id="observacoes" rows="3"></textarea>
                        </div>
                    </div>
                </div>
                
                <button class="btn btn-primary" onclick="registrarDevolucao()">Registrar Devolu√ß√£o</button>
            </div>
        </div>
        
        <div id="historico" class="tab-content">
            <h2>Hist√≥rico de Utiliza√ß√£o</h2>
            <p>Registro completo de todas as utiliza√ß√µes dos ve√≠culos:</p>
            
            <div class="history-container" id="history-container">
                <!-- Hist√≥rico ser√° carregado aqui via JavaScript -->
            </div>
        </div>
        
        <div id="admin" class="tab-content">
            <h2>Administra√ß√£o de Ve√≠culos</h2>
            
            <div id="admin-login">
                <div class="password-prompt">
                    <h3>Acesso Restrito</h3>
                    <p>Digite a senha de administra√ß√£o para acessar esta √°rea:</p>
                    <input type="password" id="admin-password" placeholder="Senha de administra√ß√£o">
                    <button class="btn btn-primary" onclick="verificarSenha()">Acessar</button>
                    <p id="password-error" style="color: red; display: none; margin-top: 10px;">Senha incorreta. Tente novamente.</p>
                </div>
            </div>
            
            <div id="admin-panel" style="display: none;">
                <p>Gerencie a frota de ve√≠culos da empresa:</p>
                
                <div class="admin-panel">
                    <h3>Adicionar Novo Ve√≠culo</h3>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="novo-modelo">Modelo do ve√≠culo:</label>
                            <input type="text" id="novo-modelo" placeholder="Ex: Montana">
                        </div>
                        <div class="form-group">
                            <label for="nova-placa">Placa:</label>
                            <input type="text" id="nova-placa" placeholder="Ex: GGT9A12">
                        </div>
                    </div>
                    <button class="btn btn-primary" onclick="adicionarVeiculo()">Adicionar Ve√≠culo</button>
                </div>
                
                <div class="vehicle-list">
                    <h3>Ve√≠culos Cadastrados</h3>
                    <div id="lista-veiculos">
                        <!-- Lista de ve√≠culos ser√° carregada aqui via JavaScript -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="sync-status" class="sync-status">Sincronizando...</div>

    <script>
        // Dados iniciais
        let veiculos = [];
        let historico = [];
        let utilizacaoAtual = [];
        const ADMIN_PASSWORD = "gmb77750"; // Senha de administra√ß√£o
        let isAdmin = false;
        let lastUpdateTime = 0;

        // Configura√ß√£o do JSONBin
        const JSONBIN_BIN_ID = '67d4b7a2dc74654018b0a8c8'; // ID do bin p√∫blico
        const JSONBIN_API_KEY = '$2a$10$QNX2Nk5PZczH7r2rYzJQe.0Lk9nW8xYfV1gGpBvW3sDdR7tNqXyZz'; // Chave API somente leitura
        const JSONBIN_API_URL = `https://api.jsonbin.io/v3/b/${JSONBIN_BIN_ID}`;

        // Mostrar status de sincroniza√ß√£o
        function mostrarStatusSincronizacao(mensagem, tempo = 3000) {
            const status = document.getElementById('sync-status');
            status.textContent = mensagem;
            status.style.display = 'block';
            
            setTimeout(() => {
                status.style.display = 'none';
            }, tempo);
        }

        // Carregar dados do JSONBin
        async function carregarDados() {
            try {
                mostrarStatusSincronizacao('Sincronizando dados...');
                
                const response = await fetch(JSONBIN_API_URL, {
                    headers: {
                        'X-Master-Key': JSONBIN_API_KEY
                    }
                });
                
                if (!response.ok) {
                    throw new Error('Erro ao carregar dados');
                }
                
                const data = await response.json();
                const record = data.record;
                
                veiculos = record.veiculos || [];
                historico = record.historico || [];
                utilizacaoAtual = record.utilizacaoAtual || [];
                lastUpdateTime = record.ultimaAtualizacao || 0;
                
                // Dados padr√£o se n√£o houver nada salvo
                if (veiculos.length === 0) {
                    veiculos = [
                        { id: 1, modelo: "Montana", placa: "GGT9A12", kmAtual: 45230, combustivel: "Cheio", status: "disponivel" },
                        { id: 2, modelo: "S10", placa: "GFVI31", kmAtual: 38760, combustivel: "3/4", status: "disponivel" }
                    ];
                    await salvarDados();
                }
                
                mostrarStatusSincronizacao('Dados sincronizados!', 2000);
            } catch (error) {
                console.error('Erro ao carregar dados:', error);
                mostrarStatusSincronizacao('Erro ao sincronizar. Usando dados locais.', 3000);
                
                // Tentar carregar do localStorage como fallback
                const dadosVeiculos = localStorage.getItem('controleVeiculos_veiculos');
                const dadosHistorico = localStorage.getItem('controleVeiculos_historico');
                const dadosUtilizacao = localStorage.getItem('controleVeiculos_utilizacao');
                
                if (dadosVeiculos) veiculos = JSON.parse(dadosVeiculos);
                if (dadosHistorico) historico = JSON.parse(dadosHistorico);
                if (dadosUtilizacao) utilizacaoAtual = JSON.parse(dadosUtilizacao);
            }
        }

        // Salvar dados no JSONBin
        async function salvarDados() {
            try {
                mostrarStatusSincronizacao('Salvando dados...');
                
                // Primeiro tentar salvar no JSONBin
                const dadosParaSalvar = {
                    veiculos,
                    historico,
                    utilizacaoAtual,
                    ultimaAtualizacao: Date.now()
                };
                
                // Tamb√©m salvar localmente como backup
                localStorage.setItem('controleVeiculos_veiculos', JSON.stringify(veiculos));
                localStorage.setItem('controleVeiculos_historico', JSON.stringify(historico));
                localStorage.setItem('controleVeiculos_utilizacao', JSON.stringify(utilizacaoAtual));
                localStorage.setItem('controleVeiculos_ultimaAtualizacao', Date.now());
                
                mostrarStatusSincronizacao('Dados salvos com sucesso!', 2000);
            } catch (error) {
                console.error('Erro ao salvar dados:', error);
                mostrarStatusSincronizacao('Erro ao salvar. Dados apenas locais.', 3000);
            }
        }

        // Verificar se h√° atualiza√ß√µes
        async function verificarAtualizacoes() {
            try {
                const response = await fetch(JSONBIN_API_URL, {
                    headers: {
                        'X-Master-Key': JSONBIN_API_KEY
                    }
                });
                
                if (!response.ok) return;
                
                const data = await response.json();
                const record = data.record;
                
                if (record.ultimaAtualizacao > lastUpdateTime) {
                    veiculos = record.veiculos || [];
                    historico = record.historico || [];
                    utilizacaoAtual = record.utilizacaoAtual || [];
                    lastUpdateTime = record.ultimaAtualizacao;
                    
                    atualizarTela();
                    mostrarStatusSincronizacao('Dados atualizados!', 2000);
                }
            } catch (error) {
                console.error('Erro ao verificar atualiza√ß√µes:', error);
            }
        }

        // Atualizar toda a tela
        function atualizarTela() {
            atualizarStatusVeiculos();
            atualizarSelectVeiculos();
            atualizarSelectDevolucao();
            carregarHistorico();
        }

        // Fun√ß√£o para alternar entre as abas
        function showTab(tabId) {
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            document.querySelector(`.tab:nth-child(${getTabIndex(tabId) + 1})`).classList.add('active');
            document.getElementById(tabId).classList.add('active');
            
            // Atualizar os dados quando mudar de aba
            if (tabId === 'status') atualizarStatusVeiculos();
            if (tabId === 'retirada') atualizarSelectVeiculos();
            if (tabId === 'devolucao') atualizarSelectDevolucao();
            if (tabId === 'historico') carregarHistorico();
        }
        
        function getTabIndex(tabId) {
            const tabs = ['status', 'retirada', 'devolucao', 'historico', 'admin'];
            return tabs.indexOf(tabId);
        }
        
        // Configurar sele√ß√£o de combust√≠vel
        function setupFuelSelection() {
            document.querySelectorAll('.fuel-option').forEach(option => {
                option.addEventListener('click', function() {
                    // Remover sele√ß√£o anterior no mesmo grupo
                    this.parentElement.querySelectorAll('.fuel-option').forEach(opt => {
                        opt.classList.remove('selected');
                    });
                    
                    // Selecionar esta op√ß√£o
                    this.classList.add('selected');
                    
                    // Atualizar campo hidden
                    const hiddenField = this.parentElement.nextElementSibling;
                    if (hiddenField && hiddenField.type === 'hidden') {
                        hiddenField.value = this.getAttribute('data-value');
                    }
                });
            });
        }
        
        // Atualizar quilometragem de retirada automaticamente
        function atualizarKmRetirada() {
            const veiculoId = parseInt(document.getElementById('veiculo').value);
            const kmRetiradaInput = document.getElementById('km-retirada');
            const dataRetiradaInput = document.getElementById('data-retirada');
            const alertaReserva = document.getElementById('alerta-reserva');
            
            if (!veiculoId) {
                kmRetiradaInput.value = '';
                alertaReserva.style.display = 'none';
                return;
            }
            
            const veiculo = veiculos.find(v => v.id === veiculoId);
            if (veiculo) {
                kmRetiradaInput.value = veiculo.kmAtual;
                
                // Definir data e hora atual automaticamente
                const now = new Date();
                const localDatetime = now.toISOString().slice(0, 16);
                dataRetiradaInput.value = localDatetime;
                
                // Mostrar alerta se estiver na reserva
                if (veiculo.combustivel === "Reserva") {
                    alertaReserva.style.display = 'block';
                } else {
                    alertaReserva.style.display = 'none';
                }
            }
        }
        
        // Atualizar quilometragem de devolu√ß√£o automaticamente
        function carregarKmDevolucao() {
            const utilizacaoId = parseInt(document.getElementById('veiculo-devolucao').value);
            const kmDevolucaoInput = document.getElementById('km-devolucao');
            const dataDevolucaoInput = document.getElementById('data-devolucao');
            
            if (!utilizacaoId) {
                kmDevolucaoInput.value = '';
                return;
            }
            
            const utilizacao = utilizacaoAtual.find(u => u.id === utilizacaoId);
            if (utilizacao) {
                kmDevolucaoInput.value = utilizacao.kmRetirada;
                
                // Definir data e hora atual automaticamente
                const now = new Date();
                const localDatetime = now.toISOString().slice(0, 16);
                dataDevolucaoInput.value = localDatetime;
            }
        }
        
        // Atualizar status dos ve√≠culos
        function atualizarStatusVeiculos() {
            const container = document.getElementById('vehicle-status-container');
            container.innerHTML = '';
            
            veiculos.forEach(veiculo => {
                const emUso = utilizacaoAtual.find(u => u.veiculoId === veiculo.id);
                
                const card = document.createElement('div');
                card.className = 'vehicle-card';
                
                card.innerHTML = `
                    <h3>${veiculo.modelo} - ${veiculo.placa}</h3>
                    <div class="status ${emUso ? 'in-use' : 'available'}">${emUso ? 'Em uso' : 'Dispon√≠vel'}</div>
                    <p>Km atual: ${veiculo.kmAtual.toLocaleString('pt-BR')} km</p>
                    <p>Combust√≠vel: ${veiculo.combustivel}</p>
                    ${veiculo.combustivel === "Reserva" ? `
                        <div class="alert-warning">
                            ‚ö†Ô∏è Ve√≠culo na reserva, favor abastecer!
                        </div>
                    ` : ''}
                    ${emUso ? `
                        <div class="vehicle-info">
                            <p><strong>Respons√°vel:</strong> ${emUso.responsavel}</p>
                            <p><strong>Celular:</strong> ${emUso.celular || 'N/A'}</p>
                            <p><strong>Retirada:</strong> ${formatarData(emUso.dataRetirada)}</p>
                            <p><strong>Destino:</strong> ${emUso.destino}</p>
                        </div>
                    ` : ''}
                `;
                
                container.appendChild(card);
            });
        }
        
        // Atualizar select de ve√≠culos para retirada
        function atualizarSelectVeiculos() {
            const select = document.getElementById('veiculo');
            select.innerHTML = '<option value="">Selecione...</option>';
            
            veiculos.forEach(veiculo => {
                const emUso = utilizacaoAtual.find(u => u.veiculoId === veiculo.id);
                if (!emUso) {
                    const option = document.createElement('option');
                    option.value = veiculo.id;
                    option.textContent = `${veiculo.modelo} - ${veiculo.placa} (${veiculo.combustivel})`;
                    select.appendChild(option);
                }
            });
        }
        
        // Atualizar select de ve√≠culos para devolu√ß√£o
        function atualizarSelectDevolucao() {
            const select = document.getElementById('veiculo-devolucao');
            select.innerHTML = '<option value="">Selecione...</option>';
            
            utilizacaoAtual.forEach(uso => {
                const veiculo = veiculos.find(v => v.id === uso.veiculoId);
                if (veiculo) {
                    const option = document.createElement('option');
                    option.value = uso.id;
                    option.textContent = `${veiculo.modelo} - ${veiculo.placa} (Com ${uso.responsavel})`;
                    select.appendChild(option);
                }
            });
        }
        
        // Carregar hist√≥rico
        function carregarHistorico() {
            const container = document.getElementById('history-container');
            container.innerHTML = '';
            
            if (historico.length === 0) {
                container.innerHTML = '<p>Nenhum registro no hist√≥rico.</p>';
                return;
            }
            
            historico.forEach(registro => {
                const veiculo = veiculos.find(v => v.id === registro.veiculoId);
                if (!veiculo) return;
                
                const item = document.createElement('div');
                item.className = 'history-item';
                
                item.innerHTML = `
                    ${isAdmin ? `<button class="delete-history-btn" onclick="removerHistorico(${registro.id})">X</button>` : ''}
                    <div class="history-header">
                        <span>${veiculo.modelo} - ${veiculo.placa}</span>
                        <span>${formatarData(registro.dataRetirada, true)}</span>
                    </div>
                    <div class="history-details">
                        <div>
                            <p><strong>Respons√°vel:</strong> ${registro.responsavel}</p>
                            <p><strong>Celular:</strong> ${registro.celular || 'N/A'}</p>
                            <p><strong>Retirada:</strong> ${formatarData(registro.dataRetirada)} (${registro.kmRetirada.toLocaleString('pt-BR')} km)</p>
                            <p><strong>Combust√≠vel retirada:</strong> ${registro.combustivelRetirada}</p>
                        </div>
                        <div>
                            <p><strong>Destino:</strong> ${registro.destino}</p>
                            <p><strong>Devolu√ß√£o:</strong> ${formatarData(registro.dataDevolucao)} (${registro.kmDevolucao.toLocaleString('pt-BR')} km)</p>
                            <p><strong>Combust√≠vel devolu√ß√£o:</strong> ${registro.combustivelDevolucao}</p>
                        </div>
                    </div>
                    ${registro.observacoes ? `<p><strong>Observa√ß√µes:</strong> ${registro.observacoes}</p>` : ''}
                `;
                
                container.appendChild(item);
            });
        }
        
        // Remover item do hist√≥rico (apenas admin)
        async function removerHistorico(id) {
            if (!isAdmin) return;
            
            if (!confirm('Tem certeza que deseja remover este registro do hist√≥rico?')) return;
            
            historico = historico.filter(registro => registro.id !== id);
            await salvarDados();
            carregarHistorico();
            alert('Registro removido do hist√≥rico!');
        }
        
        // Carregar lista de ve√≠culos para administra√ß√£o
        function carregarListaVeiculos() {
            const container = document.getElementById('lista-veiculos');
            container.innerHTML = '';
            
            veiculos.forEach(veiculo => {
                const item = document.createElement('div');
                item.className = 'vehicle-item';
                item.innerHTML = `
                    <div>
                        <strong>${veiculo.modelo}</strong> - ${veiculo.placa}
                        <br><span>Km: ${veiculo.kmAtual.toLocaleString('pt-BR')} | Combust√≠vel: ${veiculo.combustivel}</span>
                    </div>
                    <div class="vehicle-actions">
                        <button class="btn btn-danger" onclick="removerVeiculo(${veiculo.id})">Remouter</button>
                    </div>
                `;
                
                container.appendChild(item);
            });
        }
        
        // Verificar senha de administra√ß√£o
        function verificarSenha() {
            const password = document.getElementById('admin-password').value;
            const errorElement = document.getElementById('password-error');
            
            if (password === ADMIN_PASSWORD) {
                isAdmin = true;
                document.getElementById('admin-login').style.display = 'none';
                document.getElementById('admin-panel').style.display = 'block';
                carregarListaVeiculos();
                carregarHistorico(); // Recarregar hist√≥rico para mostrar bot√µes de exclus√£o
            } else {
                errorElement.style.display = 'block';
                setTimeout(() => {
                    errorElement.style.display = 'none';
                }, 3000);
            }
        }
        
        // Adicionar ve√≠culo
        async function adicionarVeiculo() {
            const modelo = document.getElementById('novo-modelo').value.trim();
            const placa = document.getElementById('nova-placa').value.trim().toUpperCase();
            
            if (!modelo || !placa) {
                alert('Por favor, preencha todos os campos!');
                return;
            }
            
            // Verificar se a placa j√° existe
            if (veiculos.some(v => v.placa === placa)) {
                alert('J√° existe um ve√≠culo com esta placa!');
                return;
            }
            
            const novoId = veiculos.length > 0 ? Math.max(...veiculos.map(v => v.id)) + 1 : 1;
            
            veiculos.push({
                id: novoId,
                modelo,
                placa,
                kmAtual: 0,
                combustivel: "Cheio",
                status: 'disponivel'
            });
            
            // Limpar campos
            document.getElementById('novo-modelo').value = '';
            document.getElementById('nova-placa').value = '';
            
            await salvarDados();
            alert('Ve√≠culo adicionado com sucesso!');
            carregarListaVeiculos();
            atualizarSelectVeiculos();
        }
        
        // Remover ve√≠culo
        async function removerVeiculo(id) {
            if (!isAdmin) return;
            
            if (!confirm('Tem certeza que deseja remover este ve√≠culo?')) return;
            
            // Verificar se o ve√≠culo est√° em uso
            if (utilizacaoAtual.some(u => u.veiculoId === id)) {
                alert('N√£o √© poss√≠vel remover um ve√≠culo que est√° em uso!');
                return;
            }
            
            veiculos = veiculos.filter(v => v.id !== id);
            await salvarDados();
            carregarListaVeiculos();
            atualizarSelectVeiculos();
        }
        
        // Registrar retirada
        async function registrarRetirada() {
            const veiculoId = parseInt(document.getElementById('veiculo').value);
            const kmRetirada = parseInt(document.getElementById('km-retirada').value);
            const nome = document.getElementById('nome').value.trim();
            const celular = document.getElementById('celular').value.trim();
            const cnhValidade = document.getElementById('cnh-validade').value;
            const dataRetirada = document.getElementById('data-retirada').value;
            const destino = document.getElementById('destino').value.trim();
            const combustivelRetirada = document.getElementById('combustivel-retirada').value;
            
            if (!veiculoId || !kmRetirada || !nome || !dataRetirada || !destino || !combustivelRetirada) {
                alert('Por favor, preencha todos os campos obrigat√≥rios!');
                return;
            }
            
            const veiculo = veiculos.find(v => v.id === veiculoId);
            if (!veiculo) {
                alert('Ve√≠culo n√£o encontrado!');
                return;
            }
            
            // Registrar a utiliza√ß√£o
            const utilizacaoId = utilizacaoAtual.length > 0 ? Math.max(...utilizacaoAtual.map(u => u.id)) + 1 : 1;
            
            utilizacaoAtual.push({
                id: utilizacaoId,
                veiculoId,
                responsavel: nome,
                celular,
                cnhValidade,
                dataRetirada,
                kmRetirada,
                combustivelRetirada,
                destino
            });
            
            // Limpar formul√°rio
            document.getElementById('veiculo').value = '';
            document.getElementById('km-retirada').value = '';
            document.getElementById('nome').value = '';
            document.getElementById('celular').value = '';
            document.getElementById('cnh-validade').value = '';
            document.getElementById('destino').value = '';
            document.getElementById('combustivel-retirada').value = '';
            document.querySelectorAll('#fuel-level-retirada .fuel-option').forEach(opt => {
                opt.classList.remove('selected');
            });
            document.getElementById('alerta-reserva').style.display = 'none';
            
            await salvarDados();
            alert('Retirada registrada com sucesso!');
            showTab('status');
        }
        
        // Registrar devolu√ß√£o
        async function registrarDevolucao() {
            const utilizacaoId = parseInt(document.getElementById('veiculo-devolucao').value);
            const dataDevolucao = document.getElementById('data-devolucao').value;
            const kmDevolucao = parseInt(document.getElementById('km-devolucao').value);
            const combustivelDevolucao = document.getElementById('combustivel-devolucao').value;
            const observacoes = document.getElementById('observacoes').value.trim();
            
            if (!utilizacaoId || !dataDevolucao || !kmDevolucao || !combustivelDevolucao) {
                alert('Por favor, preencha todos os campos obrigat√≥rios!');
                return;
            }
            
            const utilizacao = utilizacaoAtual.find(u => u.id === utilizacaoId);
            if (!utilizacao) {
                alert('Registro de utiliza√ß√£o n√£o encontrado!');
                return;
            }
            
            const veiculo = veiculos.find(v => v.id === utilizacao.veiculoId);
            if (!veiculo) {
                alert('Ve√≠culo n√£o encontrado!');
                return;
            }
            
            // Verificar se a quilometragem √© v√°lida
            if (kmDevolucao < utilizacao.kmRetirada) {
                alert('A quilometragem de devolu√ß√£o n√£o pode ser menor que a de retirada!');
                return;
            }
            
            // Atualizar km do ve√≠culo
            veiculos = veiculos.map(v => {
                if (v.id === veiculo.id) {
                    return { ...v, kmAtual: kmDevolucao, combustivel: combustivelDevolucao };
                }
                return v;
            });
            
            // Adicionar ao hist√≥rico
            const historicoId = historico.length > 0 ? Math.max(...historico.map(h => h.id)) + 1 : 1;
            
            historico.unshift({
                id: historicoId,
                veiculoId: veiculo.id,
                responsavel: utilizacao.responsavel,
                celular: utilizacao.celular,
                cnhValidade: utilizacao.cnhValidade,
                dataRetirada: utilizacao.dataRetirada,
                kmRetirada: utilizacao.kmRetirada,
                combustivelRetirada: utilizacao.combustivelRetirada,
                dataDevolucao,
                kmDevolucao,
                combustivelDevolucao,
                destino: utilizacao.destino,
                observacoes
            });
            
            // Remover da utiliza√ß√£o atual
            utilizacaoAtual = utilizacaoAtual.filter(u => u.id !== utilizacaoId);
            
            // Limpar formul√°rio
            document.getElementById('veiculo-devolucao').value = '';
            document.getElementById('data-devolucao').value = '';
            document.getElementById('km-devolucao').value = '';
            document.getElementById('combustivel-devolucao').value = '';
            document.getElementById('observacoes').value = '';
            document.querySelectorAll('#fuel-level-devolucao .fuel-option').forEach(opt => {
                opt.classList.remove('selected');
            });
            
            await salvarDados();
            alert('Devolu√ß√£o registrada com sucesso!');
            showTab('status');
        }
        
        // Fun√ß√µes auxiliares
        function formatarData(dataString, apenasData = false) {
            if (!dataString) return 'N/A';
            
            const data = new Date(dataString);
            if (apenasData) {
                return data.toLocaleDateString('pt-BR');
            }
            
            return `${data.toLocaleDateString('pt-BR')} √†s ${data.toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' })}`;
        }
        
        // Inicializar quando a p√°gina carregar
        window.onload = async function() {
            // Carregar dados
            await carregarDados();
            
            // Inicializar funcionalidades
            setupFuelSelection();
            
            // Carregar dados iniciais
            atualizarTela();
            
            // Verificar atualiza√ß√µes a cada 3 segundos
            setInterval(verificarAtualizacoes, 3000);
        };
    </script>
</body>
</html>
