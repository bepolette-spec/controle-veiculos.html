
<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <title>Sistema de Controle de Veículos</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    section { margin-bottom: 40px; }
    h2 { color: #333; }
    label, select, input, textarea, button { display: block; margin: 5px 0; }
    table { width: 100%; border-collapse: collapse; margin-top: 10px; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
    th { background-color: #f2f2f2; }
  </style>
</head>
<body>

  <h1>Sistema de Controle de Veículos Chevrolet</h1>

  <section id="retirada">
    <h2>Registrar Retirada</h2>
    <label>Motorista:</label>
    <select name="motorista"></select>
    <label>Veículo:</label>
    <select name="veiculo"></select>
    <label>KM Atual:</label>
    <input type="number" id="kmAtual">
    <label>Combustível:</label>
    <input type="text" id="combustivelRetirada">
    <label>Destino:</label>
    <input type="text" id="destino">
    <button id="btnRetirada">Registrar Retirada</button>
  </section>

  <section id="reserva">
    <h2>Reservar Veículo</h2>
    <label>Motorista:</label>
    <select name="motorista"></select>
    <label>Veículo:</label>
    <select name="veiculo"></select>
    <label>Data Início:</label>
    <input type="date" id="dataInicio">
    <label>Hora Início:</label>
    <input type="time" id="horaInicio">
    <label>Data Fim:</label>
    <input type="date" id="dataFim">
    <label>Hora Fim:</label>
    <input type="time" id="horaFim">
    <label>Destino:</label>
    <input type="text" id="destinoReserva">
    <button id="btnReserva">Reservar</button>
  </section>

  <section id="devolucao">
    <h2>Registrar Devolução</h2>
    <label>Veículo:</label>
    <select name="veiculo"></select>
    <label>KM Devolução:</label>
    <input type="number" id="kmDevolucao">
    <label>Combustível:</label>
    <input type="text" id="combustivelDevolucao">
    <label>Observações:</label>
    <textarea id="observacoes"></textarea>
    <button id="btnDevolucao">Registrar Devolução</button>
  </section>

  <section id="historico">
    <h2>Histórico de Movimentações</h2>
    <table>
      <thead>
        <tr>
          <th>Data/Hora</th>
          <th>Veículo</th>
          <th>Motorista</th>
          <th>KM Retirada</th>
          <th>Combustível Retirada</th>
          <th>KM Devolução</th>
          <th>Combustível Devolução</th>
          <th>Destino</th>
          <th>Observações</th>
          <th>Ações</th>
        </tr>
      </thead>
      <tbody id="tabelaHistorico"></tbody>
    </table>
  </section>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-app.js";
    import { getDatabase, ref, onValue, push, set } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyANtVoKUjocbqVOyrdQptlTs62RGOoNUN0",
      authDomain: "carrosfrota-a58e5.firebaseapp.com",
      databaseURL: "https://carrosfrota-a58e5-default-rtdb.firebaseio.com",
      projectId: "carrosfrota-a58e5",
      storageBucket: "carrosfrota-a58e5.firebasestorage.app",
      messagingSenderId: "107456511174",
      appId: "1:107456511174:web:220b3bc227cb450d6eebc7"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    // Preencher selects
    const selectMotoristas = document.querySelectorAll("select[name='motorista']");
    const selectVeiculos = document.querySelectorAll("select[name='veiculo']");

    onValue(ref(db, 'motoristas'), (snapshot) => {
      const data = snapshot.val();
      selectMotoristas.forEach(select => {
        select.innerHTML = '';
        for (const id in data) {
          const m = data[id];
          const option = document.createElement('option');
          option.value = id;
          option.textContent = m.nome;
          select.appendChild(option);
        }
      });
    });

    onValue(ref(db, 'veiculos'), (snapshot) => {
      const data = snapshot.val();
      selectVeiculos.forEach(select => {
        select.innerHTML = '';
        for (const id in data) {
          const v = data[id];
          const option = document.createElement('option');
          option.value = id;
          option.textContent = `${v.modelo} - ${v.placa}`;
          select.appendChild(option);
        }
      });
    });

    // Retirada
    document.getElementById("btnRetirada").addEventListener("click", () => {
      const retirada = {
        dataHora: new Date().toISOString(),
        veiculoId: document.querySelector("select[name='veiculo']").value,
        motoristaId: document.querySelector("select[name='motorista']").value,
        kmRetirada: document.getElementById("kmAtual").value,
        combustivelRetirada: document.getElementById("combustivelRetirada").value,
        destino: document.getElementById("destino").value
      };
      const novaRef = push(ref(db, 'retiradas'));
      set(novaRef, retirada);
      alert("Retirada registrada com sucesso!");
    });

    // Reserva
    document.getElementById("btnReserva").addEventListener("click", () => {
      const reserva = {
        veiculoId: document.querySelector("select[name='veiculo']").value,
        motoristaId: document.querySelector("select[name='motorista']").value,
        dataInicio: document.getElementById("dataInicio").value,
        horaInicio: document.getElementById("horaInicio").value,
        dataFim: document.getElementById("dataFim").value,
        horaFim: document.getElementById("horaFim").value,
        destino: document.getElementById("destinoReserva").value
      };
      const novaRef = push(ref(db, 'reservas'));
      set(novaRef, reserva);
      alert("Reserva registrada com sucesso!");
    });

    // Devolução
    document.getElementById("btnDevolucao").addEventListener("click", () => {
      const devolucao = {
        veiculoId: document.querySelector("select[name='veiculo']").value,
        kmDevolucao: document.getElementById("kmDevolucao").value,
        combustivelDevolucao: document.getElementById("combustivelDevolucao").value,
        observacoes: document.getElementById("observacoes").value
      };
      const novaRef = push(ref(db, 'devolucoes'));
      set(novaRef, devolucao);
      alert("Devolução registrada com sucesso!");
    });

    // Histórico
    const tabela = document.getElementById("tabelaHistorico");
    onValue(ref(db, 'historico'), (snapshot) => {
      const data = snapshot.val();
      tabela.innerHTML = '';
      for (const id in data) {
        const h = data[id];
        const row = document.createElement("tr");
        row.innerHTML = `
          <td>${h.dataHora}</td>
          <td>${h.veiculo}</td>
          <td>${h.motorista}</td>
          <td>${h.kmRetirada}</td>
          <td>${h.combustivelRetirada}</td>
          <td>${h.kmDevolucao}</td>
          <td>${h.combustivelDevolucao}</td>
          <td>${h.destino}</td>
          <td>${h.observacoes}</td>
          <td><button onclick="removerHistorico('${id}')">Excluir</button></td>
        `;
        tabela.appendChild(row);
      }
    });

    window.removerHistorico = function(id) {
      set(ref(db, `historico/${id}`), null);
      alert("Histórico removido.");
    };
  </script>

</body>
</html>
