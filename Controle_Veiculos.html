<!DOCTYPE html>
<html>
<head>
  <title>Sistema de Controle de Frota Chevrolet</title>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
</head>
<body>
  <h1>Controle de Frota Chevrolet</h1>

  <h2>Cadastro de Pessoas</h2>
  <input type="text" id="nomePessoa" placeholder="Nome da pessoa">
  <button onclick="cadastrarPessoa()">Cadastrar Pessoa</button>
  <ul id="listaPessoas"></ul>

  <h2>Cadastro de Veículos Chevrolet</h2>
  <input type="text" id="nomeVeiculo" placeholder="Modelo Chevrolet">
  <button onclick="cadastrarVeiculo()">Cadastrar Veículo</button>
  <ul id="listaVeiculos"></ul>

  <h2>Retirada de Veículo</h2>
  <select id="selectPessoaRetirada"></select>
  <select id="selectVeiculoRetirada"></select>
  <button onclick="registrarRetirada()">Registrar Retirada</button>

  <h2>Devolução de Veículo</h2>
  <select id="selectVeiculoDevolucao"></select>
  <button onclick="registrarDevolucao()">Registrar Devolução</button>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyA7pTa-7rQsiA0C5Ud6QbvTRJdwB8IuRGI",
      authDomain: "controle-veiculos-27ba1.firebaseapp.com",
      databaseURL: "https://controle-veiculos-27ba1-default-rtdb.firebaseio.com",
      projectId: "controle-veiculos-27ba1",
      storageBucket: "controle-veiculos-27ba1.firebasestorage.app",
      messagingSenderId: "1084808734247",
      appId: "1:1084808734247:web:54c8fe5de2ed8471cd5002",
      measurementId: "G-TWCJMV8PXD"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    function cadastrarPessoa() {
      const nome = document.getElementById("nomePessoa").value;
      if (nome) {
        const id = "pessoa_" + Date.now();
        db.ref("pessoas/" + id).set({ nome: nome });
        document.getElementById("nomePessoa").value = "";
      }
    }

    function cadastrarVeiculo() {
      const nome = document.getElementById("nomeVeiculo").value;
      if (nome && nome.toLowerCase().includes("chevrolet")) {
        const id = "chevrolet_" + Date.now();
        db.ref("veiculos/" + id).set({ nome: nome, status: "Disponível" });
        document.getElementById("nomeVeiculo").value = "";
      } else {
        alert("Somente veículos Chevrolet são permitidos.");
      }
    }

    function registrarRetirada() {
      const pessoaId = document.getElementById("selectPessoaRetirada").value;
      const veiculoId = document.getElementById("selectVeiculoRetirada").value;
      if (pessoaId && veiculoId) {
        db.ref("veiculos/" + veiculoId).update({ status: "Retirado", por: pessoaId });
        db.ref("historico/" + Date.now()).set({ acao: "Retirada", pessoa: pessoaId, veiculo: veiculoId, data: new Date().toISOString() });
      }
    }

    function registrarDevolucao() {
      const veiculoId = document.getElementById("selectVeiculoDevolucao").value;
      if (veiculoId) {
        db.ref("veiculos/" + veiculoId).update({ status: "Disponível", por: null });
        db.ref("historico/" + Date.now()).set({ acao: "Devolução", veiculo: veiculoId, data: new Date().toISOString() });
      }
    }

    function atualizarListas() {
      db.ref("pessoas").on("value", snapshot => {
        const lista = document.getElementById("listaPessoas");
        const select = document.getElementById("selectPessoaRetirada");
        lista.innerHTML = "";
        select.innerHTML = "";
        snapshot.forEach(child => {
          const nome = child.val().nome;
          const id = child.key;
          lista.innerHTML += "<li>" + nome + "</li>";
          select.innerHTML += `<option value="${id}">${nome}</option>`;
        });
      });

      db.ref("veiculos").on("value", snapshot => {
        const lista = document.getElementById("listaVeiculos");
        const selectRetirada = document.getElementById("selectVeiculoRetirada");
        const selectDevolucao = document.getElementById("selectVeiculoDevolucao");
        lista.innerHTML = "";
        selectRetirada.innerHTML = "";
        selectDevolucao.innerHTML = "";
        snapshot.forEach(child => {
          const veiculo = child.val();
          const id = child.key;
          lista.innerHTML += `<li>${veiculo.nome} - ${veiculo.status}</li>`;
          if (veiculo.status === "Disponível") {
            selectRetirada.innerHTML += `<option value="${id}">${veiculo.nome}</option>`;
          }
          if (veiculo.status === "Retirado") {
            selectDevolucao.innerHTML += `<option value="${id}">${veiculo.nome}</option>`;
          }
        });
      });
    }

    atualizarListas();
  </script>
</body>
</html>
